<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="utf-8">
  <title>经纬度</title>
  <!-- logo -->
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
  <!-- 引入百度地图API -->
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=XkvQEbTfOQHGCLTiKXZ4EmqK0e9BYbet"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      border: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #f5f3f0;
    }

    .title {
      /* z-index: 1; */
      text-align: center;
      /* margin-bottom: 20px; */
      background-color: #f5f3f0;
    }

    .content {
      border: 1px solid #000;
    }

    #list-container {
      float: left;
      background-color: #f3f5f0;
      width: 6%;
    }

    #list-container button:hover {
      background-color: #afa3a3;
      color: #fff;
    }

    #list-container button:active {
      background-color: skyblue;
    }

    #list-container button {
      margin-bottom: 7px;
      width: 100%;
      /* height: 100%; */

      text-align: center;
      font-size: 20px;
      background-color: #f3f5f0;
    }

    #map {
      margin: 0px 6%;
      width: 69%;
      height: 900px;
      overflow: hidden;
      border-left: 1px solid #000;
      border-right: 1px solid #000;
    }

    #sidebar {
      float: right;
      width: 25%;
      height: 100%;
      padding: 5px;
      /* position: absolute;
      top: 9%;
      left: 76%; */
      background-color: #f3f5f0;
      /* border-top: 1px solid #000;
      border-bottom: 1px solid #000; */
    }

    #sidebar h1,
    #sidebar h2,
    #sidebar h3,
    #sidebar img {
      margin-bottom: 15px;
    }

    #sidebar img {
      width: 100%;
    }

    #sidebar span {
      font-weight: bold;
      color: #5a5a5a;
    }

    #sidebar h2 {
      font-weight: normal;
    }

    #sidebar h3 {
      font-weight: normal;
      font-size: 16px;
    }

    .search {
      border-radius: 84px;
      height: 45px;
      width: 415px;
      background-color: #ffffff;
      /* overflow: hidden; */
      background-color: rgba(255, 255, 255, 0.5);

      position: absolute;
      top: 80px;
      left: 10%;
      z-index: 1;
      box-shadow: rgba(0, 0, 0, 0.35) 0px 5px 15px;
    }

    .search:hover {
      box-shadow: rgba(0, 0, 0, 0.5) 0px 5px 15px;
    }

    .search input {
      float: left;
      padding-left: 20px;
      outline: none;
      background-color: rgba(0, 0, 0, 0);
      width: 360px;
      height: 45px;

      font-size: 15px;
      color: #000;
      margin-top: 1px;
    }

    .search input::placeholder {
      color: #767676;
      vertical-align: auto;
      font-size: 16px;
    }

    .search button {
      float: right;
      border-radius: 100%;
      margin-right: 5px;
      width: 50px;
      height: 49px;
      background-color: rgba(0, 0, 0, 0);

      cursor: pointer;
    }

    .search input:active {
      background-color: transparent;
    }

    .search button svg {
      width: 30px;
      height: 30px;
      line-height: 55px;
    }
  </style>
</head>

<body>
  <h1 class="title">探寻中草药足迹</h1>
  <!-- 显示搜索结果 -->
  <div id="search-result" style="text-align: right">&nbsp;</div>
  <div class="content">
    <!--创建一个在html列表，每个元素添加点击事件-->
    <div id="list-container"></div>

    <!-- 地图容器 -->
    <div id="map" style="position: absolute;"></div>

    <!-- 侧边栏 -->
    <div id="sidebar">
      <!-- <h2>草药信息</h2> -->
      <div id="herbInfo">
      </div>
    </div>
  </div>

  <!-- 搜索框 -->
  <div class="search">

    <input type="text" id="searchInput" onkeypress="searchKeyPress(event)" placeholder="搜索草药/地名：" title="输入：草药名/地名">
    <button onclick="findHerbData(query)" id="searchButton" title="搜索">
      <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24"
        stroke-width="1.5" stroke="#707070" fill="none" stroke-linecap="round" stroke-linejoin="round">
        <path stroke="none" d="M0 0h24v24H0z" fill="none" />
        <circle cx="10" cy="10" r="7" />
        <line x1="21" y1="21" x2="15" y2="15" />
      </svg>
    </button>

  </div>

  <!-- 引入 jQuery 库 -->
  <script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <!-- 这里可以通过ajax等方式从服务器获取中草药植物的位置信息和区域信息数据并转换为mapPoint列表 -->
  <script type="text/javascript">


    // 地图初始化
    // 百度地图 API 提供的定位器类
    var geolocation = new BMap.Geolocation();
    var map = new BMap.Map("map");
    // 设置地图中心点和缩放级别
    var point = new BMap.Point(112.044, 22.929); // 默认定位到云浮市区
    map.centerAndZoom(point, 13);

    // 铺满全屏
    var mapContainer = document.getElementById("map");
    mapContainer.style.height = window.innerHeight + "px";
    window.onresize = function () {
      mapContainer.style.height = window.innerHeight + "px";
    }
    const herbData = [
      {
        name: '两面针',
        pic: "https://i.zyccst.com/upload/upay/926566/2/E4B8A4E99DA2E99288312E6A7067.jpg",
        address: '云浮市云城区',
        lng: 112.03,
        lat: 22.93,
        information: "活血化瘀，行气止痛，祛风通络，解毒消肿。用于跌扑损伤，胃痛，牙痛，风湿痹痛，毒蛇咬伤；外治烧烫伤。"
      },
      {
        name: '岗梅',
        pic: "https://i.zyccst.com/upload/upay/926566/2/E5B297E6A285E6A0B9352E6A7067.jpg",
        address: '云浮市云安区石城镇',
        lng: 111.95190,
        lat: 22.74840,
        information: "清热解毒，生津，利咽，散瘀止痛，治流感高热，急性扁桃体炎、咽喉炎、肺脓肿，跌打损伤，疥疮，颈淋巴结核。"
      },
      {
        name: '黄精',
        pic: "https://img14.360buyimg.com/n0/jfs/t1/22865/32/19748/71336/638f281cE08dcbbc6/fb03a3a29bccc18e.jpg",
        address: '云安区、新兴县和郁南县的山林地带',
        lng: 111.940791,
        lat: 23.122835,
        information: "养阴润燥、止咳化痰、滋补肝肾等。黄精富含黄精甙、黄精内酯、黄精素等多种成分，具有补虚止汗、滋阴润燥、润肺化痰等作用，可用于治疗肺虚咳嗽、痨病、自汗盗汗、脱发等症状。"
      },

      {
        name: '当归',
        pic: "https://img95.699pic.com/photo/50133/1811.jpg_wh860.jpg",
        address: '云浮市新兴县大坪村',
        lng: 112.139487,
        lat: 22.703955,
        information: "补血活血、调经止痛、润肠通便等。当归富含挥发油、甾醇、香豆素等成分，具有增加血流、舒张血管、调节免疫系统等作用，可用于治疗女性病、中风后遗症、便秘等症状。"
      },

      {
        name: '珍珠母',
        pic: "https://www.yt1998.com/attached/image/20170714/20170714074113_725.jpg",
        address: '罗定市和云安区的山地和林带中',
        lng: 111.950791,
        lat: 23.122835,
        information: "清热解毒、镇静安神、润肺化痰等。珍珠母富含碳酸钙、鞣质等成分，具有清热解毒、镇定安神、润肺化痰等作用，可用于治疗发热、痰多、咳嗽、失眠、焦虑等症状"
      },

      {
        name: '金银花',
        pic: "https://www.penzai.com/uploads/img/202006/16/1592319313657732.jpg",
        address: '云安、新兴和罗定等县市',
        lng: 111.949282,
        lat: 23.079437,
        information: "清热去火、解毒消肿、抗菌消炎等。金银花富含黄酮类、糖类、挥发油等成分，具有清热解毒、抗病毒、降血压、抗过敏等作用，可用于治疗感冒、麻疹、痘痘、疮疖等症状。"
      },

      {
        name: '灵芝',
        pic: "https://img.huabaike.com/tukuimgs/168/DSCF5543.jpg",
        address: '云安区的山地和林带中',
        lng: 111.862464,
        lat: 23.073717,
        information: "增强免疫力、抗肿瘤、调节代谢等。灵芝富含多糖、三萜类化合物、脂肪等成分，具有抗肿瘤、增强免疫力、降低血脂、调节代谢等作用，可用于治疗癌症、肝炎、高血压等症状。"
      },

      {
        name: '天麻',
        pic: "https://cbu01.alicdn.com/img/ibank/2018/396/961/9176169693_1817533240.jpg",
        // pic: "天麻.jpg",
        address: '新兴县和罗定市的山地和林带中',
        lng: 111.822835,
        lat: 22.922835,
        information: "镇静安神、止痛消炎、祛风去湿等。天麻富含天麻素、天麻酯等多种成分，具有调节中枢神经系统、抗炎镇痛、改善睡眠、祛风除湿等作用，可用于治疗头痛、失眠、中风、关节炎、风湿性疾病等症状。在中药方剂中常用天麻与其他药材组合，如天麻钩藤汤、天麻地黄丸等。"
      },

      {
        name: '紫金草',
        pic: "https://photo.tuchong.com/1206372/f/13904145.jpg",
        address: '云浮市新兴县天露山旅游度假区',
        lng: 112.229568,
        lat: 22.494994,
        information: "被广泛应用于中医领域，并获得了很好的疗效。其他功效还包括：清热解毒，利尿通淋，解毒消肿，止咳化痰等。"
      },

      {
        name: '石斛',
        pic: "	https://pic2.zhimg.com/v2-6a8be18f8631d6cee64c9ea3be3b3b19_r.jpg",
        address: '广东省云浮市五云山自然保护区',
        lng: 111.728389,
        lat: 22.942325,
        information: "补虚损，养阴润肺，补血安神"
      },

      {
        name: '黄芪',
        pic: "https://www.ziyimall.com/file_img/products/63/201801/19/20180119143841Jhmlv8s9.jpg",
        address: '广东省云浮市罗定市田东镇',
        lng: 111.561,
        lat: 22.842,
        information: "益气固表，生津止渴，固肾益精"
      },

      {
        name: '丹参',
        pic: "https://cbu01.alicdn.com/img/ibank/2017/759/821/4855128957_2064642299.jpg",
        address: '广东省云浮市新兴县',
        lng: 112.214,
        lat: 22.708,
        information: "活血化瘀，清热解毒，消肿止痛"
      },

      {
        name: '五味子',
        pic: "https://p1.ssl.qhimg.com/t01a2fde2dca9797071.jpg",
        address: '广东省云浮市郁南县',
        lng: 111.534,
        lat: 23.235,
        information: "固肾止泻，润肺止咳，安神益智"
      },

      {
        name: '首乌',
        pic: "https://pic.quanjing.com/td/js/QJ9125786839.jpg",
        address: '广东省云浮市云安区',
        lng: 111.877,
        lat: 23.078,
        information: "补血益肾，黑发乌须，润肠通便"
      },

      {
        name: '牛大力',
        pic: "https://imgserver.zyctd.com/Images/2020/12/16/21/11/12c57f7dd9814353b3e612bb0f2e9336.jpg",
        address: '云浮市云城区腰古镇牛头塱村（小阳农业牛大力标准化种植基地）',
        lng: 112.248566,
        lat: 22.888639,
        information: "<br>1.润肺养肾</br>" +
          "牛大力有平肝、润肺，养肾补虚，强筋活络之功效，主治肾虚，气虚，腰酸腿痛、风湿病、慢性肝炎、支气管炎，咳嗽，肺结核等有很好的疗效。</br>" +
          "2.清热解毒</br>" +
          "此外，牛大力有助清热解毒的功效吃煎炸食物过多，通晓熬夜，用牛大力煲汤，有消肿解毒、改善便秘的功效。</br>" +
          "3.改善便秘</br>" +
          "牛大力除拥有独特香气外，还含有丰富食物纤维，有助改善便秘，牛大力甘平，有补虚润肺、强筋活络的功用"
      },
      // {name: '',pic:'',address: '',lng: ,lat: ,information: ""},
      // {name: '',pic:'',address: '',lng: ,lat: ,information: ""},
      // {name: '',pic:'',address: '',lng: ,lat: ,information: ""},
      // {name: '',pic:'',address: '',lng: ,lat: ,information: ""},
    ];

    var mapPoints = herbData.map(function (data) {
      var point = new BMap.Point(data.lng, data.lat);
      var marker = new BMap.Marker(point);
      // 显示草药名称
      marker.setTitle(data.name);
      // 在标志点上添加中草药名称和基本信息，并绑定事件
      marker.addEventListener("click", function () {
        showInfo(data);
      });
      return marker;
    });

    // 将标志点添加到地图上
    for (let i = 0; i < mapPoints.length; i++) {
      map.addOverlay(mapPoints[i]);
    }
    showAllHerbName();


    // Enter点击事件
    function searchKeyPress(e) {
      // 如果按下了enter键，且输入框有内容，则触发搜索按钮的点击事件
      if (e.keyCode === 13) {
        document.getElementById("searchButton").click();
      }
    }

    /**
     * 搜素功能*/
    const searchInput = document.getElementById("searchInput");
    const searchButton = document.getElementById("searchButton");
    const herbInfo = document.getElementById("herbInfo");
    searchButton.addEventListener("click", () => {
      const query = searchInput.value;
      const index = findHerbData(query);
      //搜索-展示中药详情
      if (index !== -1) {
        searchInput.value = ""
        showInfo(herbData[index]);
        {//缩放该药位置
          const point = new BMap.Point(herbData[index].lng, herbData[index].lat);
          map.centerAndZoom(point, 18);
        }
      } else if (query !== "" && index === -1) {
        //搜地名
        search();
        herbInfo.innerHTML = ""
      } else {
        alert("您的输入有误，请检查！");
        // showAllHerbName();
        herbInfo.innerHTML = ""
      }
    });

    // 搜地名
    function search() {
      var keyword = $("#searchInput").val().trim();
      if (keyword !== "") {
        // 百度地图 API 提供的本地搜索类
        var localSearch = new BMap.LocalSearch(map, {
          onSearchComplete: function (results) {
            if (localSearch.getStatus() === BMAP_STATUS_SUCCESS) {
              var poi = results.getPoi(0);
              // 定位到搜索结果的位置，并放大地图缩放级别
              map.centerAndZoom(poi.point, 15);
              // 创建标记点并添加到地图
              var marker = new BMap.Marker(poi.point);
              map.addOverlay(marker);
              marker.setTitle(keyword);
              // 显示搜索结果
              $("#search-result").text(
                "已定位到：" + keyword + "（经度：" + poi.point.lng + "，纬度：" + poi.point.lat + "）"
              );
            } else {
              alert("搜索失败，请重试");
            }
          },
        });
        localSearch.search(keyword); // 添加关键字（如“中草药种植园”）以便搜到具体位置
      }
    }

    // 查找中药，存在返回索引
    function findHerbData(query) {
      for (let index = 0; index < herbData.length; index++) {
        if (herbData[index].name === query) {
          return index;
        }
      }
      return -1;
    }


    //展示所有药名
    function showAllHerbName() {
      let array = herbData.map(herb => herb.name);
      let listContainer = document.getElementById("list-container");
      let itemsPerPage = 15;
      let pageNum = 1;
      // 创建翻页按钮
      let pageTurner = document.createElement("button");
      pageTurner.id = "pageTurner";
      pageTurner.innerHTML = "下一页";
      pageTurner.onclick = function () {        pageNum++;
        showItems(pageNum);
      }
      listContainer.appendChild(pageTurner);
      function showItems(pageNum) {
        let startIndex = (pageNum - 1) * itemsPerPage;
        let endIndex = startIndex + itemsPerPage;
        let itemsToShow = array.slice(startIndex, endIndex);
        listContainer.innerHTML = ""; // 清空
        itemsToShow.forEach(name => {
          let item = document.createElement("div");
          listContainer.appendChild(item);
          let btn = document.createElement("button");
          btn.innerHTML = name;
          btn.onclick = function () {
            let herb = herbData.find(h => h.name === name);
            showInfo(herb);
            let point = new BMap.Point(herb.lng, herb.lat);
            map.centerAndZoom(point, 14);
          }
          item.appendChild(btn);
        })
        // 更新翻页按钮点击事件
        if (pageNum * itemsPerPage >= array.length) {
          pageTurner.disabled = true;
        } else {
          pageTurner.disabled = false;
        }
      }
      showItems(pageNum);
    }


    // 展示中草药详细信息
    function showInfo(data) {
      document.getElementById("herbInfo").innerHTML = `
                <h2><span>【中药名】</span>${data.name}</h2>
                <img src=${data.pic} alt="图片格式错误">
                <h3><span>【产地】</span>${data.address}</h3>
                <p><span>【主要功效】</span>${data.information}</p>`;
      // document.getElementById("sidebar").style.left = "calc(80%)";
    }
  </script>
</body>

</html>